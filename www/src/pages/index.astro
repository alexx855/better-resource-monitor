---
import { getCollection, render } from 'astro:content';
import Layout from '../layouts/Layout.astro';

const docs = await getCollection('docs');
const readme = docs[0];
const { Content } = await render(readme);

const title = 'Silicon Monitor - macOS Menu Bar System Monitor';
const description = 'A blazing-fast, lightweight macOS menu bar system monitor built with Rust and Tauri.';
---

<Layout title={title} description={description}>
  <style>
    /* ===== Modern CSS Reset ===== */
    *, *::before, *::after { box-sizing: border-box; }
    * { margin: 0; padding: 0; }
    
    html {
      -webkit-text-size-adjust: 100%;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    
    body {
      min-height: 100vh;
      line-height: 1.6;
    }
    
    img, picture, video, canvas, svg {
      display: block;
      max-width: 100%;
      height: auto;
    }
    
    p, h1, h2, h3, h4, h5, h6 { overflow-wrap: break-word; }
    
    /* ===== Design Tokens ===== */
    :root {
      --bg: #0d1117;
      --surface: #161b22;
      --text: #e6edf3;
      --text-muted: #8b949e;
      --border: #30363d;
      /* WCAG AA compliant link color (4.5:1 contrast ratio on #0d1117) */
      --link: #79c0ff;
      --link-hover: #a5d6ff;
      --font-sans: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
      --font-mono: ui-monospace, SFMono-Regular, "SF Mono", Menlo, Consolas, monospace;
    }
    
    /* ===== Base Styles ===== */
    html {
      background: var(--bg);
      color: var(--text);
      font-family: var(--font-sans);
      font-size: 16px;
    }
    
    /* ===== Layout ===== */
    .container {
      width: 100%;
      max-width: 830px;
      margin: 0 auto;
      padding: 2rem 1.5rem;
    }
    
    article {
      width: 100%;
    }
    
    /* ===== Utilities ===== */
    .visually-hidden {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }

    /* ===== Typography ===== */
    h1, h2, h3, h4 { 
      color: #fff;
      font-weight: 600;
      margin-top: 1.5rem;
      margin-bottom: 1rem;
    }
    
    h2 { 
      font-size: 1.5rem; 
      padding-bottom: 0.5rem;
      border-bottom: 1px solid var(--border); 
    }
    
    h3 { 
      font-size: 1.25rem; 
    }
    
    p { 
      margin-bottom: 1rem; 
      color: var(--text);
    }
    
    strong { 
      color: #fff; 
      font-weight: 600; 
    }
    
    /* ===== Links (WCAG AA Compliant) ===== */
    a { 
      color: var(--link); 
      text-decoration: underline;
      text-underline-offset: 2px;
    }
    
    a:hover, a:focus { 
      color: var(--link-hover);
    }
    
    /* ===== Lists ===== */
    ul, ol { 
      margin: 1rem 0; 
      padding-left: 2rem; 
    }
    
    li { 
      margin: 0.375rem 0; 
      color: var(--text);
    }
    
    /* ===== Code ===== */
    code {
      font-family: var(--font-mono);
      background: rgba(110, 118, 129, 0.4);
      padding: 0.2em 0.4em;
      border-radius: 6px;
      font-size: 0.875em;
      color: var(--text);
    }
    
    pre {
      background: var(--surface);
      padding: 1rem;
      border-radius: 6px;
      overflow-x: auto;
      border: 1px solid var(--border);
      margin: 1rem 0;
    }
    
    pre code {
      background: none;
      padding: 0;
      font-size: 0.875em;
    }
    
    /* ===== Tables ===== */
    /* Table wrapper added by JS */
    .table-wrapper {
      width: 100%;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      margin: 1rem 0;
      border: 1px solid var(--border);
      border-radius: 6px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      /* Removed display: block to preserve semantics */
    }
    
    th, td {
      padding: 0.5rem 0.75rem;
      border: 1px solid var(--border);
      text-align: left;
      white-space: nowrap;
    }
    
    th { 
      background: var(--surface); 
      font-weight: 600; 
      color: #fff;
    }
    
    /* ===== Images ===== */
    img { 
      border-radius: 6px;
      height: auto;
    }
    
    /* Hero image - full width */
    p[align="center"] img[alt="Silicon Monitor"] {
      width: 100%;
      max-width: 100%;
      height: auto;
      border-radius: 8px;
      box-shadow: 0 4px 24px rgba(0, 0, 0, 0.4);
    }
    
    /* Center-aligned paragraphs (GitHub README style) */
    p[align="center"] { 
      text-align: center; 
      margin-bottom: 1rem;
    }
    
    /* Badge images - inline */
    p[align="center"] img[src^="https://img.shields.io"] {
      display: inline-block;
      vertical-align: middle;
      margin: 0; /* Margin handled by link padding if wrapped */
      border-radius: 4px;
      height: auto;
      width: auto;
      max-width: none;
    }

    /* WCAG 2.5.8 Target Size (Minimum 24px, ideally 44px) */
    /* Enhance touch targets for badge links */
    :global(p[align="center"] a) {
      display: inline-block !important;
      padding: 12px !important; /* Increases hit area significantly */
      margin: -8px; /* Offset the padding to maintain visual layout approximately, or allow it to breathe */
    }

    /* Semantic Navigation List Styling */
    .nav-list {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      list-style: none;
      padding: 0;
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .nav-list li {
      margin: 0;
    }
    
    /* ===== Horizontal Rule ===== */
    hr { 
      border: none; 
      border-top: 1px solid var(--border); 
      margin: 2rem 0; 
    }
    
    /* ===== Mobile Responsive ===== */
    @media (max-width: 600px) {
      html {
        font-size: 15px;
      }
      
      .container {
        padding: 1.25rem 1rem;
      }
      
      h2 { font-size: 1.375rem; }
      h3 { font-size: 1.125rem; }
      
      pre {
        font-size: 0.8125em;
        padding: 0.75rem;
      }
      
      th, td {
        padding: 0.375rem 0.5rem;
        font-size: 0.875rem;
      }
    }
  </style>

  <main class="container">
    <article>
      <h1 class="visually-hidden">Silicon Monitor</h1>
      <Content />
    </article>
  </main>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // 1. Table Wrapper for Accessibility
      document.querySelectorAll('table').forEach(table => {
        const wrapper = document.createElement('div');
        wrapper.className = 'table-wrapper';
        wrapper.setAttribute('tabindex', '0');
        wrapper.setAttribute('role', 'region');
        wrapper.setAttribute('aria-label', 'Table container');
        table.parentNode?.insertBefore(wrapper, table);
        wrapper.appendChild(table);
      });

      // 2. Convert Navigation Paragraph to Semantic List
      const centerParagraphs = document.querySelectorAll('p[align="center"]');
      // Look for the paragraph containing "Features" and "Why" links
      for (const p of centerParagraphs) {
        if (p.textContent && p.textContent.includes('Features') && p.textContent.includes('Why')) {
          const links = p.querySelectorAll('a');
          if (links.length > 0) {
            const ul = document.createElement('ul');
            ul.className = 'nav-list';
            ul.setAttribute('role', 'list');

            links.forEach(link => {
              const li = document.createElement('li');
              // Clone the link to preserve events/attributes
              li.appendChild(link.cloneNode(true));
              ul.appendChild(li);
            });

            // Replace the paragraph with the new list
            p.parentNode?.replaceChild(ul, p);
          }
          break; // Stop after finding the nav paragraph
        }
      }
    });
  </script>
</Layout>
